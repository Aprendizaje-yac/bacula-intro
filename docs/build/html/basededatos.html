

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Agregar backup de base de datos a Bacula &mdash; documentación de Bacula - 0.0.1</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="Como restaurar backups en bacula" href="recuperar.html" />
    <link rel="prev" title="Saber a que archivos se le están haciendo backups" href="revision.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Bacula
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contenido:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduccion.html">Introducción a Bacula</a></li>
<li class="toctree-l1"><a class="reference internal" href="instalacion.html">Instalando Bacula en la PSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="revision.html">Saber a que archivos se le están haciendo backups</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Agregar backup de base de datos a Bacula</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intruccion">Intrucción</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pasos-para-agregar-una-base-de-datos">Pasos para agregar una base de datos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="recuperar.html">Como restaurar backups en bacula</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bacula</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Agregar backup de base de datos a Bacula</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/basededatos.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="agregar-backup-de-base-de-datos-a-bacula">
<h1>Agregar backup de base de datos a Bacula<a class="headerlink" href="#agregar-backup-de-base-de-datos-a-bacula" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="intruccion">
<h2>Intrucción<a class="headerlink" href="#intruccion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para poder realizar backups de la base de datos, se decidió llevarlo a cabo de la siguiente manera:
En tyrion, se despliegan dockers (con el nombre de la base de datos a backupear), y este docker hara el dump remoto a la base)</p>
</div>
<div class="section" id="pasos-para-agregar-una-base-de-datos">
<h2>Pasos para agregar una base de datos<a class="headerlink" href="#pasos-para-agregar-una-base-de-datos" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic simple">
<li><p>Obtenemos la ip del servidor donde se encuentra la base de datos</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">databases</span><span class="o">-</span><span class="n">mariadb</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="n">psi</span> <span class="n">ipadd</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>En tyrion accedemos al /etc/hosts y agregamos el servidor nuevo:</p></li>
</ol>
<div class="highlight-txt notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  172.19.27.112 g3-nodo-6.backup.unc.edu.ar
  172.19.27.113 g3-nodo-7.backup.unc.edu.ar
  172.19.27.114 g3-nodo-8.backup.unc.edu.ar
  172.19.27.115 g3-nodo-9.backup.unc.edu.ar
  172.23.16.66 huemul-1.backup.unc.edu.ar
  172.23.48.29 moodle-dev-memcached.backup.unc.edu.ar
  172.23.48.27 moodle-dev-nodo1.backup.unc.edu.ar
  172.23.48.28 moodle-dev-nodo2.backup.unc.edu.ar
  172.23.16.68 noc-jenkins-1.backup.unc.edu.ar
  172.23.16.80 nuxeo-dev-2.backup.unc.edu.ar
  172.23.16.79 openvas-1.backup.unc.edu.ar
  172.23.16.78 phpmyadmin.backup.unc.edu.ar
  172.23.16.77 phppgadmin.backup.unc.edu.ar
  172.23.16.83 spgi-mapuche-api-5.backup.unc.edu.ar
  172.23.16.75 spgi-mapuche-consulta.backup.unc.edu.ar
</pre></div>
</td></tr></table></div>
<p><em>Aclaración: por ahora se lo agrega en los falta agregar ya que se le realizará backup por medio de la red de administración hasta que tenga interfaz por la red de backup.</em></p>
<ol class="arabic simple" start="2">
<li><p>Comprobar la conexión por medio haciendo:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="n">databases</span><span class="o">-</span><span class="n">mariadb</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="n">backup</span><span class="o">.</span><span class="n">unc</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">ar</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Acceder a <strong>/root/tools/configuration/data/dbarmy/databases.yml</strong> y agregar el nuevo servidor. Ejemplo:</p></li>
</ol>
<div class="highlight-txt notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  - service_name: mariadb-slave
    database_srv: databases-mariadb-slave.backup.unc.edu.ar
    port: 9052
    type: mysql
    ipv4_address:  192.168.2.2
    ipv4_army: 172.23.15.150
  [...]
  - service_name: databases-2
    database_srv: databases-2.backup.unc.edu.ar
    type: mysql
    port: 9059
    ipv4_address:  192.168.2.3
    ipv4_army: 172.23.15.150
  - service_name: databases-mariadb-dev
    database_srv: databases-mariadb-dev.backup.unc.edu.ar
    type: mysql
    port: 9060
    ipv4_address:  192.168.2.3
    ipv4_army: 172.23.15.150
</pre></div>
</td></tr></table></div>
<p><em>Se completa el service_name con el nombre del servidor y database_srv con la dirección completa del servidor. A port el incrementamos uno del anterior (databases-mariadb-3 es 9057 entonce este es 9058), En type colocamos el tipo, y ipv4_address lo dejamos como esta (ya no se usa) y ipv4_army contiene la ip del servidor tyrion.</em></p>
<ol class="arabic simple" start="4">
<li><p>Luego se ejecuta: <em>/root/tools/configuration/actualizar_stack_bd.sh</em></p></li>
</ol>
<p>Dicho script toma del stack de rancher “databases” aquellos servicios que están inactivos y los guarda en /tmp/inactivos.tmp
Luego se ejecuta el script de python que genera los clients, jobs y filesets correspondientes. Finalmente actualiza la carpeta donde bacula lee los clients, jobs y filesets y verifica que las configuraciones sean las correctas antes de reiniciar el director.
Luego se accede a la carpeta /root/tools/stacks/bd-army/ donde se encuentra el rancher-compose.yml y allí se levanta el stack databases
Finalmente se leen cada una de las entradas de los servicios inactivos guardados en /tmp/inactivos.tmp
Por último se recarga el servicio bacula-director en el director</p>
<p><strong>Es necesario, que el servidor de la base de datos tenga el puerto habilitado, y creado los permisos necesarios para el usuario de bacula</strong></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="recuperar.html" class="btn btn-neutral float-right" title="Como restaurar backups en bacula" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="revision.html" class="btn btn-neutral float-left" title="Saber a que archivos se le están haciendo backups" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Spitale Solange, Vazquez Petrini Santiago

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>